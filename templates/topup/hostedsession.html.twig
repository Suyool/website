{% extends 'base.html.twig' %}

{% block body %}
	{# <style id="antiClickjack">
		body {
			display: none !important;
		}
	</style> #}
	<script src="https://test-bobsal.gateway.mastercard.com/form/version/72/merchant/testsuyool/session.js"></script>
	<div>Please enter your payment details:</div>
	<h3>Credit Card</h3>
	<div>Card Number:
	<input type="text" id="card-number" class="input-field" title="card number" readonly/></div>
	<div>Expiry Month:<input type="text" id="expiry-month" class="input-field" title="expiry month" aria-label="two digit expiry month" value="" tabindex="2" readonly></div>
	<div>Expiry Year:<input type="text" id="expiry-year" class="input-field" title="expiry year" aria-label="two digit expiry year" value="" tabindex="3" readonly></div>
	<div>Security Code:<input type="text" id="security-code" class="input-field" title="security code" aria-label="three digit CCV security code" value="" tabindex="4" readonly></div>
	<div>Cardholder Name:<input type="text" id="cardholder-name" class="input-field" title="cardholder name" aria-label="enter name on card" value="" tabindex="5" readonly></div>
	<div>
		<button id="payButton" onclick="pay('card');">Pay Now</button>
	</div>
	<script type="text/javascript">

PaymentSession.configure({
session: "{{ session }}",
fields: { // ATTACH HOSTED FIELDS TO YOUR PAYMENT PAGE FOR A CREDIT CARD
card: {
number: "#card-number",
securityCode: "#security-code",
expiryMonth: "#expiry-month",
expiryYear: "#expiry-year",
nameOnCard: "#cardholder-name"
}
},
// SPECIFY YOUR MITIGATION OPTION HERE
frameEmbeddingMitigation: ["javascript"],
callbacks: {
initialized: function (response) { // HANDLE INITIALIZATION RESPONSE
},
formSessionUpdate: function (response) { // HANDLE RESPONSE FOR UPDATE SESSION
console.log(response)
if (response.status) {
if ("ok" == response.status) {
console.log("Session updated with data: " + response.session.id);
$.ajax({
url: "/pay", method: "POST",
 data: { card: response.sourceOfFunds.provided.card.number },
success: function (response) {
console.log(response)
},
error: function (xhr, status, error) { // Show an error message in the console
console.error(error);
}
});
// check if the security code was provided by the user
if (response.sourceOfFunds.provided.card.securityCode) {
console.log("Security code was provided.");
}

// check if the user entered a Mastercard credit card
if (response.sourceOfFunds.provided.card.scheme == 'MASTERCARD') {
console.log("The user entered a Mastercard credit card.")
}
} else if ("fields_in_error" == response.status) {

console.log("Session update failed with field errors.");
if (response.errors.cardNumber) {
console.log("Card number invalid or missing.");
}
if (response.errors.expiryYear) {
console.log("Expiry year invalid or missing.");
}
if (response.errors.expiryMonth) {
console.log("Expiry month invalid or missing.");
}
if (response.errors.securityCode) {
console.log("Security code invalid.");
}
} else if ("request_timeout" == response.status) {
console.log("Session update failed with request timeout: " + response.errors.message);
} else if ("system_error" == response.status) {
console.log("Session update failed with system error: " + response.errors.message);
}
} else {
console.log("Session update failed: " + response);
}
}
},
interaction: {
displayControl: {
formatCard: "EMBOSSED",
invalidFieldCharacters: "REJECT"
}
}
});

PaymentSession.onValidityChange([
    "card.number",
    "card.nameOnCard",
    "card.securityCode",
    "card.expiryYear",
    "card.expiryMonth"
    ], function (selector, result) { // Get the value of the input using jQuery
    
    if (result.isValid) {
        var inputValue = $(".gw-proxied").val();
    // Log the value to the console or use it as needed
    console.log("Input Value:", inputValue);
    document.querySelector(selector).style.borderColor = "green";
    } else if (result.isIncomplete) {
    document.querySelector(selector).style.borderColor = "grey";
    } else {
    document.querySelector(selector).style.borderColor = "red";
    }
    });


function pay() { // UPDATE THE SESSION WITH THE INPUT FROM HOSTED FIELDS
PaymentSession.updateSessionFromForm('card');
}
	</script>
{% endblock %}
