{% extends 'Admin/base.html.twig' %}

{% block content %}

    <h1 class="mb-4">Products</h1>

    {{ form_start(importForm, {'attr': {'class': 'form'}}) }}
    <div class="mb-3 w-25">
        {{ form_label(importForm.csvFile, 'Choose a CSV file') }}
        {{ form_widget(importForm.csvFile, {'attr': {'class': 'form-control'}}) }}

        {% if importForm.csvFile.vars.errors|length > 0 %}
            <div class="invalid-feedback">
                {{ importForm.csvFile.vars.errors|first.message }}
            </div>
        {% endif %}
    </div>

    <button type="submit" class="btn btn-primary">Import</button>

    {{ form_end(importForm) }}
    <a href="{{ path('export_csv_product') }}" class="d-flex justify-content-end">
        <i class="fas fa-file-csv fa-lg"></i>
    </a>
    <table class="table">
        <thead>
        <tr>
            <th scope="col">{{ knp_pagination_sortable(products, 'id', 'p.id') }}</th>
            <th scope="col">{{ knp_pagination_sortable(products, 'productId', 'p.productId') }}</th>
            <th scope="col">{{ knp_pagination_sortable(products, 'categoryId', 'p.categoryId') }}</th>
            <th scope="col">{{ knp_pagination_sortable(products, 'title', 'p.title') }}</th>
            <th scope="col">image</th>
            <th scope="col">{{ knp_pagination_sortable(products, 'sellPrice', 'p.sellPrice') }}</th>
            <th scope="col">{{ knp_pagination_sortable(products, 'price', 'p.price') }}</th>
            <th scope="col">{{ knp_pagination_sortable(products, 'discountRate', 'p.discountRate') }}</th>
            <th scope="col">{{ knp_pagination_sortable(products, 'inStock', 'p.inStock') }}</th>
            <th scope="col">{{ knp_pagination_sortable(products, 'currency', 'p.currency') }}</th>
            <th scope="col">{{ knp_pagination_sortable(products, 'Canceled', 'p.canceled') }}</th>
            <th scope="col">Action</th>
        </tr>
        </thead>
        <tbody>
        {% for product in products %}

            <tr>
                <td>{{ product.id }}</td>
                <td>{{ product.productId }}</td>
                <td>{{ product.categoryId }}</td>
                <td>{{ product.title }}</td>
                <td><img src="{{ product.image }}" width="100px"/></td>
                <td>{{ product.sellPrice }}</td>
                <td>{{ product.price }}</td>
                <td>{{ product.discountRate }}</td>
                <td>{{ product.inStock }}</td>
                <td>{{ product.currency }}</td>
                <td>{{ product.canceled }}</td>
                <td>
                    <div class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1"
                                data-bs-toggle="dropdown" aria-expanded="false">
                            Action
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                            <li>
                                <a class="dropdown-item"
                                   href="{{ path('admin_gift2games_update_canceled',{'id':product.id}) }}">
                                    {% if product.canceled %}Enabled{% else %}Disabled
                                    {% endif %}
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#exampleModal"
                                   data-id="{{ product.id }}">Update Sell Price</a>
                            </li>
                        </ul>
                    </div>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <div class="pagination justify-content-center">
        {{ knp_pagination_render(products) }}
    </div>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Change Sell Price</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="" id="updateSellPriceForm" method="post">
                        <input type="number" name="sellprice" min="1" step="0.01" required>
                        <button type="submit" class="btn btn-primary">Save changes</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    {# <button type="button" class="btn btn-primary" onclick="updateSellPrice()">Save changes</button> #}
                </div>
            </div>
        </div>
    </div>
    <script>
        var nodeList = document.querySelectorAll('[data-bs-target="#exampleModal"]');

        nodeList.forEach(function (element) {
            element.addEventListener('click', function () {
                var productId = element.dataset.id;
                console.log(productId);
                document.getElementById('updateSellPriceForm').action = "/admin/gift2games/update/" + productId;
            });
        });

        function updateSellPrice() {
            document.getElementById('updateSellPriceForm').submit();
        }
    </script>


{% endblock %}
